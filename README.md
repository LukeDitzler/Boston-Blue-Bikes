# Boston Blue Bikes — Koop Provider

A custom [Koop](https://koopjs.github.io/) provider that fetches real-time BlueBikes station data from the publicly available GBFS feed, merges station information with live availability status, and serves the result as a GeoJSON FeatureCollection via an Esri FeatureServer endpoint.

---

## Data Sources

This project consumes two endpoints from the [BlueBikes GBFS (General Bikeshare Feed Specification)](https://github.com/MobilityData/gbfs) public API:

| Endpoint | Description |
|---|---|
| `https://gbfs.bluebikes.com/gbfs/en/station_information.json` | Static station metadata: name, location (lat/lon), and capacity |
| `https://gbfs.bluebikes.com/gbfs/en/station_status.json` | Real-time availability: bikes available, docks available, renting/returning status, last reported timestamp |

Both endpoints are open and require no API key. Data is fetched live on every request with no caching.

---

## What This Does

The Koop provider performs the following steps on each request:

1. **Fetches both GBFS endpoints in parallel** using `Promise.all` to minimize latency.
2. **Indexes station status by `station_id`** for O(1) lookup when merging.
3. **Joins the two datasets** on `station_id`, combining static metadata with live availability.
4. **Derives a `percent_available` field** calculated as `(bikes_available / capacity) * 100`, rounded to the nearest integer.
5. **Builds a valid GeoJSON FeatureCollection** with Point geometries (longitude, latitude) and a full set of properties per station.
6. **Serves the result through Koop's Geoservices output plugin**, making it available as an Esri FeatureServer endpoint consumable by QGIS, ArcGIS, and other GIS clients.

---

## Output Fields

Each feature in the FeatureCollection includes the following properties:

| Field | Type | Description |
|---|---|---|
| `station_id` | String | Unique station identifier from GBFS |
| `name` | String | Human-readable station name |
| `capacity` | Integer | Total number of docks at the station |
| `bikes_available` | Integer | Number of bikes currently available |
| `docks_available` | Integer | Number of empty docks currently available |
| `percent_available` | Integer | Bikes available as a percentage of total capacity |
| `is_renting` | Integer | 1 if the station is currently renting bikes, 0 if not |
| `is_returning` | Integer | 1 if the station is currently accepting returns, 0 if not |
| `last_reported` | Integer | Unix timestamp of the last status update from the station |
| `OBJECTID` | Integer | Auto-generated by Koop for Esri client compatibility |

---

## Project Structure

```
blue-bikes-koop/
├── index.js                        # Main entry point — configures and starts the Koop server
└── providers/
    └── bluebikes/
        ├── index.js                # Provider registration (name, version, type, Model)
        └── model.js                # Data fetching, merging, and GeoJSON construction
```

---

## Setup & Usage

### Prerequisites

- Node.js v18+
- npm

### Install

```bash
npm install
```

### Run

```bash
npm start
```

The server starts at `http://localhost:8080`.

### Query the Data

```
http://localhost:8080/bluebikes/0/FeatureServer/0/query
```

This returns a full Esri FeatureServer response containing all BlueBikes stations with live availability data.

To verify the provider is registered:

```
http://localhost:8080/bluebikes/rest/info
```

---

## Loading into QGIS

1. Hit the query URL in your browser and save the response as `bluebikes.geojson`
2. In QGIS: **Layer → Add Layer → Add Vector Layer**, select the saved file
3. Right-click the layer → **Properties → Symbology**
4. Set style to **Graduated**, column to `percent_available`
5. Apply a diverging color ramp (e.g. red → green) to visualize station availability across Greater Boston

---

## Built With

- [Koop](https://koopjs.github.io/) — Geospatial data server framework by Esri
- [BlueBikes GBFS](https://www.bluebikes.com/system-data) — Public bikeshare system data
- Node.js built-in `fetch` (Node 18+)
